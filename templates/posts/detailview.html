{% extends "posts/base.html" %}
{% load static %}
{% load tz %}

{% block formeta %}
<meta property="og:description" content="{{share_post_description}}" />
<meta property="og:title" content="{{share_post_title}}" />
<meta property="og:image" content="{{ share_post_thumbnail}}" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:url" content="{{share_post_url}}" />
 {% endblock formeta%}

 
 {% block forstyle %}

 {%endblock forstyle %}

{% block forcontent %}

    <!-- Post Detail Wrapper Start -->
    <div class="post-detail-wrapper" >
        
        <p>{{share_post_description}}</p>
        <p>{{share_post_title}}</p>
        <p>{{share_post_url}}</p>

            <div class="post-detail-main-content">

                <div class="post-detail-title">{{post.title}}</div>
                <div class="post-detail-header">
                    {% if post.author.profile_picture %}
                        <img  class="remove-transition"   src="{{ post.author.profile_picture.url }}" alt="Author" class="post-detail-author-image">
                    {% else %}
                        <img src="{% static 'posts/images/default_profile.png' %}" alt="Author" class="post-detail-author-image">
                    {% endif %}

                    <div class="post-detail-author">{{ post.author.username|default:"Anonymous" }}</div>
                    <div class="post-detail-share-icons">

                        <a href="https://api.whatsapp.com/send?text=Check%20this%20out!%0A%0A{{ share_post_title }}%0A%0A{{ share_post_description }}%0A%0A{{ share_post_thumbnail }}%0A%0A{{ share_post_url }}" target="_blank">
                            <img src="{% static 'posts/images/whatsapp.png' %}" alt="WhatsApp">
                        </a>

                        <a href="https://www.facebook.com/sharer/sharer.php?u={{ share_post_url }}" target="_blank">
                            <img src="{% static 'posts/images/facebook.png' %}" alt="Facebook">
                        </a>

                        <a href="https://twitter.com/intent/tweet?text={{ share_post_title }}%0A%0A{{ share_post_description }}%0A%0A{{ share_post_url }}" target="_blank">
                            <img src="{% static 'posts/images/twitter.png' %}" alt="Twitter">
                        </a>

                    </div>
                </div>
                <div class="post-detail-content">



                    <img class="remove-transition"  src="{{share_post_thumbnail}}" alt="thumbnail" width="100%" height="400px">
                    

                    {{post.content|safe}}
                
                </div>

            </div>


            <div class="post-detail-comment-section" data-authenticated="{{check_user}}">

                <div class="comments-container">

                    

                    <div class="comment-vote-container">
                        <div class="comment-vote-item">
                            <img src="{% static 'posts/images/comment.png' %}" > <!-- Comment icon -->
                            <span>{{ post.comments_count }} Comments</span>
                        </div>
                        <div class="comment-vote-item">
                            <img src="{% static 'posts/images/vote_black.png' %}" >
                            <span>{{ post.likes_count }} Votes</span>
                        </div>
                    </div>

                    {% for comment in post.postcomments_set.all %}

                    <div class="comment">
                        {% if comment.user %}
                        <span>
                            {{ comment.user.username }} :
                            {% if not comment.published %}
                                <span class="bending-text">[bending]</span>
                            {% endif %}
                        </span>
                    {% elif comment.name %}
                        <span>
                            {{ comment.name }} :
                            {% if not comment.published %}
                                <span class="bending-text">[bending]</span>
                            {% endif %}
                        </span>
                    {% else %}
                        <span>
                            public user :
                            {% if not comment.published %}
                                <span class="bending-text">[bending]</span>
                            {% endif %}
                        </span>
                    {% endif %}
                        
                        <span class="comment-date">{{comment.created|date:"d"}}{{comment.created|date:"M Y"}}</span>
                        {% if comment.published %}
                        <p>{{comment.text}}</p>
                        {%else%}
                        <p>waiting for approval</p>
                        {%endif%}
                    </div>
                    {% empty %}
                    <div class="no-comments-yet">No comments yet.</div>
                    {% endfor %}

                </div>
        
                <div class="comment-form-container">
                    <form id="comment-form">
                        <textarea id="comment-input" placeholder="Add your comment here" required></textarea>
                        <input type="text" id="name-input" placeholder="Name" required>
                        <input type="email" id="email-input" placeholder="E-mail" required>
                        <button type="submit" id="submit-button">Post Comment</button>
                    </form>
                </div>
            </div>




    </div>
    <!-- Post Detail Wrapper End -->





        <!-- Popular Posts Start -->
        <div class="popular-post-container">

 

                    {% if random_posts %}
                    {% for post in random_posts %}
                    <div class="popular-post" data-url="{{post.get_absolute_url}}">
                    <img src="{{post.image_url}}" alt="Image">
                    <div class="popular-post-content">
                        <div class="popular-post-title">{{post.title}}</div>
                        <div class="popular-post-date-and-icon popular-post-date">
                            <time datetime="" >{{post.get_display_date|date:"d" }}{{post.get_display_date|date:"M Y" }}</time>
                            <i class="fa-solid fa-arrow-up-right-from-square green-post-icon"></i>
                        </div>
                    </div>
                </div>
                {% endfor %}
                {% endif %} 

          



        </div>
<!-- Popular Posts End -->



    <!-- Scrollable  Posts Start -->
    <div class="scrollable-container-wrapper">

                <div class="scroll-indicator scroll-indicator-left"><i class="fa fa-arrow-left"></i></div>
                <div class="scrollable-container">
                    
                    {% if related_posts %}
                     {% for post in related_posts%}
                    <div class="scrollable-post" data-url="{{post.get_absolute_url}}">
                        <div class="scrollable-post-content">
                            <div class="scrollable-post-date">{{post.get_display_date|date:"d" }}{{post.get_display_date|date:"M Y" }}</div>
                            <i class="fa-solid fa-arrow-up-right-from-square scrollable-post-icon"></i>
                            <img src="{{post.image_url}}" alt="Image">
                            <div class="scrollable-post-title">{{post.title}}</div>
                        </div>
                    </div>
                    {% endfor %}
                    {% endif %}




                </div>
                <div class="scroll-indicator scroll-indicator-right"><i class="fa fa-arrow-right"></i> </div>

    </div>
    <!-- Scrollable Post END -->


{% endblock forcontent%}


{% block forscript %}



<script >

    document.addEventListener('DOMContentLoaded', function () {

        var postDetailCommentSection =document.querySelector(".post-detail-comment-section");
        var isAuthenticatedUser=postDetailCommentSection.getAttribute("data-authenticated");
        var nameInput = document.getElementById('name-input');
        var emailInput = document.getElementById('email-input');
        if(isAuthenticatedUser=="True"){
            console.log("user is authenticated",isAuthenticatedUser);
            nameInput.removeAttribute('required');
            emailInput.removeAttribute('required');
            nameInput.style.display = 'none';
            emailInput.style.display = 'none';
        }

    });

    const commentInput = document.getElementById('comment-input');
    const submitButton = document.getElementById('submit-button');

    commentInput.addEventListener('input', function() {
        if (commentInput.value.trim() !== '') {
            submitButton.style.visibility = 'visible';
        } else {
            submitButton.style.visibility = 'hidden';
        }
    });

    document.getElementById('comment-form').addEventListener('submit', function(e) {
        e.preventDefault();

        const nameInput = document.getElementById('name-input').value;
        const username="{{request.user.username}}"
        const emailInput = document.getElementById('email-input').value;
        const commentInputText = document.getElementById('comment-input').value;

        if (commentInputText.trim() !== '') {
            const newComment = document.createElement('div');
            newComment.classList.add('comment');
            if(nameInput.trim()===""){
                newComment.innerHTML =`<span>{{request.user.username}} : <span class="bending-text">[bending]</span></span><span class="comment-date">just now</span><p>${commentInputText}</p>`;
            }else{
                newComment.innerHTML =`<span>${nameInput}: <span class="bending-text">[bending]</span></span><span class="comment-date">just now</span><p>${commentInputText}</p>`;              
            }
           

            document.querySelector('.comments-container').appendChild(newComment);

            document.getElementById('name-input').value = '';
            document.getElementById('email-input').value = '';
            document.getElementById('comment-input').value = '';

            submitButton.style.visibility = 'hidden'; 
        }
    });

</script>

{% endblock forscript%}